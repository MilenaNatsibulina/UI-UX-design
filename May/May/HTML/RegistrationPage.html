<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Регистрация</title>
    <link rel="stylesheet" href="../CSS/Styles.css">
</head>

<body>
    <!--Шапка-->
    <div class="centering-container">
        <div class="header">
            <div class="logo nav-item" onclick="location.href='MainPage.html'">Май</div>
            <div class="nav-item" onclick="location.href='MyMay.html'">мой Май</div>
            <div class="nav-item" onclick="location.href='MyMasterClasses-Planned.html'">мастер-классы</div>
            <div class="nav-item" onclick="location.href='MyOrders.html'">заказы</div>
            <div class="nav-item" onclick="location.href='DessertCart.html'">корзина</div>
            <div class="account nav-item" onclick="location.href='MyAccount.html'">
                <div></div><img src="../Icons/User(Black).svg" alt="User">личный кабинет
            </div>
        </div>
    </div>
    <div class="line"></div>

    <!--Форма-->
    <div class="form-container">
        <form action="..." method="post">
            <div class="form-group">
                <div class="field-desc">Имя пользователя</div>
                <input class="inputfield" type="text" id="username" name="username" required
                    placeholder="Имя пользователя">
                <div class="help">*имя должно быть уникальным и написано латиницей</div>
            </div>

            <div class="form-group">
                <div class="field-desc">E-mail</div>
                <input class="inputfield" type="email" id="email" name="email" required placeholder="E-mail">
            </div>

            <div class="form-group">
                <div class="field-desc">Пароль</div>
                <input class="inputfield" type="password" id="password1" name="password" required placeholder="Пароль">
            </div>

            <div class="form-group">
                <div class="field-desc">Повторите пароль</div>
                <input class="inputfield" type="password" id="password2" name="password" required
                    placeholder="Повторите пароль">
            </div>

            <div class="btncontainer">
                <button class="orangebtn" type="submit">Зарегистрироваться</button>
            </div>
        </form>
    </div>

</body>
<script src="../JS/auth.js"></script>
<script src="../JS/csvHandler.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const authSystem = new AuthSystem();
    
    // Если пользователь уже авторизован, перенаправляем в личный кабинет
    if (authSystem.isAuthenticated()) {
        window.location.href = 'MyAccount.html';
        return;
    }

    // Находим форму и поля
    const nameInput = document.querySelector('input[placeholder*="пользователя"]') || 
                     document.querySelector('input[name*="name"]') ||
                     document.querySelectorAll('input[type="text"]')[0];
    
    const emailInput = document.querySelector('input[type="email"]') ||
                      document.querySelector('input[placeholder*="mail"]');
    
    const passwordInputs = document.querySelectorAll('input[type="password"]');
    const passwordInput = passwordInputs[0];
    const confirmPasswordInput = passwordInputs[1];
    
    const registerBtn = document.querySelector('button') || 
                       document.querySelector('input[type="submit"]');

    if (registerBtn) {
        registerBtn.addEventListener('click', async function(e) {
            e.preventDefault();
            
            const name = nameInput?.value?.trim() || '';
            const email = emailInput?.value?.trim() || '';
            const password = passwordInput?.value || '';
            const confirmPassword = confirmPasswordInput?.value || '';

            try {
                await authSystem.register(email, name, password, confirmPassword);
                
                alert('Регистрация успешна! Теперь вы можете войти в систему.');
                
                // Перенаправляем на страницу входа
                window.location.href = 'LoginPage.html';
                
            } catch (error) {
                alert(`Ошибка регистрации: ${error.message}`);
                console.error('Ошибка регистрации:', error);
            }
        });
    }
});
</script>


</html>